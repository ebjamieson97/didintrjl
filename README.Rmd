---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# didintrjl

<!-- badges: start -->
[![R-CMD-check](https://github.com/ebjamieson97/didintrjl/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/ebjamieson97/didintrjl/actions/workflows/R-CMD-check.yaml)
[![CRAN status](https://www.r-pkg.org/badges/version/didintrjl)](https://CRAN.R-project.org/package=didintrjl)
[![Codecov test coverage](https://codecov.io/gh/ebjamieson97/didintrjl/graph/badge.svg)](https://app.codecov.io/gh/ebjamieson97/didintrjl)
<!-- badges: end -->

## Overview

**didintrjl** is an R wrapper for the Julia package [DiDInt.jl](https://ebjamieson97.github.io/DiDInt.jl/dev/), which implements intersection difference-in-differences (DID-INT),
a method developed by [Karim & Webb (2025)](https://arxiv.org/abs/2412.14447). DID-INT allows for unbiased estimation of the average effect of treatment on the treated
(ATT) in cases when the common causal covariates (CCC) assumption is violated.

## Installation

You can install the development version of didintrjl with:
``` r
# install.packages("remotes")
remotes::install_github("ebjamieson97/didintrjl")
```

## Examples

### `didint()`
The `didint()` function returns an object with the class `DiDIntObj` which has three S3 methods: `print()`, `summary()`, and `coef()`. Each of these methods
have the argument `level` which can take either `"agg"` or `"sub"` in order to distinguish between aggregate results and sub-aggregate results. For example,
in a staggered adoption setting with several different treatment times, setting `level = "sub"` will return information pertinent to the distinct treatment times, whereas
`level = "agg"` would return the aggregated results.

```{r}
# Load data
df <- read.csv("inst/extdata/merit.csv")

# Load didintrjl and run didint()
library(didintrjl)
res <- didint("coll", "state", "year", df, verbose = FALSE,
              treated_states = c(71, 58, 64, 59, 85, 57, 72, 61, 34, 88),
              treatment_times = c(1991, 1993, 1996, 1997, 1997, 1998, 1998, 1999, 2000, 2000))

# Show summary of results
summary(res)

# The aggregate and sub-aggregate results can also be accessed via
res$agg
res$sub
```

### `didint_plot()`
The `didint_plot()` function returns an object of the class `DiDIntPlotObj` which has one S3 method: `plot()`. This object also stores the data used to create the plot
so that users may directly access the plotting data and create their own customized plots. `didint_plot()` can produce either parallel trends plots or event study plots.

```{r plots, fig.width=8, fig.height=10, out.width = "100%", dpi=300, fig.align="center"}
# Generate the DiDIntPlotObj for event study plot
res_event <- didint_plot(
  "coll", "state", "year", df, event = TRUE,
  treated_states = c(71, 58, 64, 59, 85, 57, 72, 61, 34, 88),
  treatment_times = c(1991, 1993, 1996, 1997, 1997, 1998, 1998, 1999,
                      2000, 2000),
  covariates = c("asian", "black", "male")
)

plot(res_event)

# For purposes of demonstration, it would be a bit cluttered to show the
# parallel trends for each state in the dataset, so here we will just use
# a subset
df_sub <- df[df$state %in% c(71, 58, 11, 34, 14), ]
res_parallel <- didint_plot("coll", "state", "year", df_sub,
                            treatment_times = c(1991, 1993, 2000),
                            covariates = c("asian", "black", "male"))

plot(res_parallel)
```

For both the event study plots and the parallel trends plots it is possible to specify which combination of plots you would like to view via the `ccc` argument.

```{r more_plots, fig.width=8, fig.height=10, out.width = "100%", dpi=300, fig.align="center"}

plot(res_parallel, ccc = "state")

plot(res_event, ccc = c("none", "hom", "int"))
```

If you would like to create your own customized plots using the plotting data, you can acccess it via `DiDIntPlotObj$data`.

```{r}
head(res_parallel$data)
head(res_event$data)
```